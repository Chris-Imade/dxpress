<!-- Shipments Management Page -->
<div class="dashboard-card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
            <i class="fas fa-box"></i>
        </div>
        <div>
            <div class="card-title">Shipments Management</div>
            <div class="card-subtitle">View and manage all shipments</div>
        </div>
        <div style="margin-left: auto;">
            <a href="/admin/shipments/create" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                New Shipment
            </a>
        </div>
    </div>
</div>

<!-- Search and Filter Section -->
<div class="dashboard-card" style="margin-bottom: 24px;">
    <div style="padding: 20px;">
        <form method="GET" action="/admin/shipments" style="display: grid; grid-template-columns: 1fr auto auto; gap: 16px; align-items: end;">
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Search Shipments</label>
                <input 
                    type="search" 
                    style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: all 0.2s ease;"
                    placeholder="Search by tracking ID, customer name, email, phone..." 
                    name="search" 
                    value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
                >
            </div>
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Filter by Status</label>
                <select name="status" style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; min-width: 150px;">
                    <option value="" <%= !statusFilter ? 'selected' : '' %>>All Statuses</option>
                    <option value="Pending" <%= statusFilter === 'Pending' ? 'selected' : '' %>>Pending</option>
                    <option value="In Transit" <%= statusFilter === 'In Transit' ? 'selected' : '' %>>In Transit</option>
                    <option value="Delivered" <%= statusFilter === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                    <option value="Delayed" <%= statusFilter === 'Delayed' ? 'selected' : '' %>>Delayed</option>
                    <option value="Cancelled" <%= statusFilter === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="height: fit-content;">
                <i class="fas fa-search"></i>
                Search
            </button>
        </form>
    </div>
</div>

<!-- Results Summary -->
<div style="margin-bottom: 16px; color: #6b7280; font-weight: 500;">
    Total: <%= pagination.totalItems %> shipments found
</div>
<!-- Shipments Table -->
<div class="table-container" style="margin-bottom: 24px;">
    <div class="table-header">
        <h3 class="table-title">All Shipments</h3>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151;">Tracking ID</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151;">Customer</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151;">Route</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151;">Status</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151;">Created</th>
                    <th style="padding: 16px; text-align: center; font-weight: 600; color: #374151;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (shipments && shipments.length > 0) { %>
                    <% shipments.forEach(function(shipment) { %>
                    <tr style="border-bottom: 1px solid #f3f4f6;">
                        <td style="padding: 16px; font-weight: 600; color: #032330;"><%= shipment.trackingId %></td>
                        <td style="padding: 16px;">
                            <div style="font-weight: 600; color: #374151;"><%= shipment.customerName %></div>
                            <div style="font-size: 12px; color: #6b7280;"><%= shipment.customerEmail %></div>
                        </td>
                        <td style="padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; margin-bottom: 4px;"></div>
                                    <div style="width: 2px; height: 20px; background: #e5e7eb;"></div>
                                    <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%; margin-top: 4px;"></div>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">
                                        <i class="fas fa-map-marker-alt" style="color: #10b981; margin-right: 4px;"></i>
                                        <%= shipment.origin.city %>, <%= shipment.origin.country %>
                                    </div>
                                    <div style="font-weight: 600; color: #374151;">
                                        <i class="fas fa-map-marker-alt" style="color: #ef4444; margin-right: 4px;"></i>
                                        <%= shipment.destination.city %>, <%= shipment.destination.country %>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 16px; text-align: right;">
                            <% let statusClass = 'pending'; %>
                            <% if (shipment.status === 'Delivered') statusClass = 'delivered'; %>
                            <% if (shipment.status === 'In Transit') statusClass = 'transit'; %>
                            <% if (shipment.status === 'Cancelled') statusClass = 'cancelled'; %>
                            <% if (shipment.status === 'Delayed') statusClass = 'delayed'; %>
                            <span class="status-badge <%= statusClass %>"><%= shipment.status %></span>
                        </td>
                        <td style="padding: 16px; color: #6b7280;"><%= new Date(shipment.createdAt).toLocaleDateString() %></td>
                        <td style="padding: 16px; text-align: center;">
                            <div style="display: flex; gap: 8px; justify-content: center;">
                                <a href="/admin/shipments/edit/<%= shipment._id %>" style="padding: 8px; background: #f3f4f6; border: none; border-radius: 6px; color: #6b7280; text-decoration: none; transition: all 0.2s ease; display: inline-block;">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button 
                                    class="delete-shipment-btn" 
                                    data-id="<%= shipment._id %>"
                                    style="padding: 8px; background: #fee2e2; border: none; border-radius: 6px; color: #dc2626; cursor: pointer; transition: all 0.2s ease;"
                                    onclick="confirmDelete('<%= shipment._id %>')"
                                >
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="6" style="padding: 40px; text-align: center; color: #6b7280;">
                            <i class="fas fa-box" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                            <div>No shipments found</div>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
<% if (pagination.totalPages > 1) { %>
<div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 24px;">
    <% if (pagination.page > 1) { %>
        <a href="/admin/shipments?page=<%= pagination.page-1 %><%= statusFilter ? '&status='+statusFilter : '' %><%= searchQuery ? '&search='+encodeURIComponent(searchQuery) : '' %>" 
           style="padding: 8px 16px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 6px; color: #374151; text-decoration: none; transition: all 0.2s ease;">
            <i class="fas fa-chevron-left"></i> Previous
        </a>
    <% } %>
    
    <% for(let i = 1; i <= pagination.totalPages; i++) { %>
        <% if (i === pagination.page) { %>
            <span style="padding: 8px 12px; background: #032330; color: white; border-radius: 6px; font-weight: 600;"><%= i %></span>
        <% } else { %>
            <a href="/admin/shipments?page=<%= i %><%= statusFilter ? '&status='+statusFilter : '' %><%= searchQuery ? '&search='+encodeURIComponent(searchQuery) : '' %>" 
               style="padding: 8px 12px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 6px; color: #374151; text-decoration: none; transition: all 0.2s ease;"><%= i %></a>
        <% } %>
    <% } %>
    
    <% if (pagination.page < pagination.totalPages) { %>
        <a href="/admin/shipments?page=<%= pagination.page+1 %><%= statusFilter ? '&status='+statusFilter : '' %><%= searchQuery ? '&search='+encodeURIComponent(searchQuery) : '' %>" 
           style="padding: 8px 16px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 6px; color: #374151; text-decoration: none; transition: all 0.2s ease;">
            Next <i class="fas fa-chevron-right"></i>
        </a>
    <% } %>
</div>
<% } %>

<script>
function confirmDelete(shipmentId) {
    if (confirm('Are you sure you want to delete this shipment? This action cannot be undone.')) {
        fetch(`/admin/shipments/delete/${shipmentId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.reload();
            } else {
                alert('Error deleting shipment: ' + (data.message || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while deleting the shipment.');
        });
    }
}
</script> 