<!-- Edit User Page -->
<div class="dashboard-card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
            <i class="fas fa-user-edit"></i>
        </div>
        <div>
            <div class="card-title">Edit User</div>
            <div class="card-subtitle">Update user information and permissions</div>
        </div>
        <div style="margin-left: auto;">
            <a href="/admin/users" style="display: inline-flex; align-items: center; padding: 10px 16px; background: #6b7280; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: 500; transition: background-color 0.2s;">
                <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
                Back to Users
            </a>
        </div>
    </div>
</div>

<!-- Edit User Form -->
<div class="dashboard-card">
    <div style="padding: 24px;">
        <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
            <div style="background: #fee2e2; border: 1px solid #fecaca; color: #dc2626; padding: 12px; border-radius: 6px; margin-bottom: 20px;">
                <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                <%= errorMessage %>
            </div>
        <% } %>
        
        <form action="/admin/users/update/<%= user._id %>" method="POST">
            <!-- User Information Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-user" style="margin-right: 8px; color: #6b7280;"></i>
                    User Information
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">Full Name</label>
                        <input type="text" id="name" name="name" value="<%= user.name || '' %>" required 
                               style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: border-color 0.2s ease;" 
                               onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e5e7eb'">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">Email Address</label>
                        <input type="email" id="email" name="email" value="<%= user.email %>" required 
                               style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: border-color 0.2s ease;" 
                               onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e5e7eb'">
                    </div>
                </div>
            </div>

            <!-- Role & Security Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-shield-alt" style="margin-right: 8px; color: #6b7280;"></i>
                    Role & Security
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">User Role</label>
                        <select id="role" name="role" required 
                                style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; transition: border-color 0.2s ease;" 
                                onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e5e7eb'">
                            <option value="user" <%= user.role === 'user' ? 'selected' : '' %>>User</option>
                            <option value="staff" <%= user.role === 'staff' ? 'selected' : '' %>>Staff</option>
                            <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>Admin</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">New Password (Optional)</label>
                        <input type="password" id="password" name="password" placeholder="Leave blank to keep current password" 
                               style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: border-color 0.2s ease;" 
                               onfocus="this.style.borderColor='#8b5cf6'" onblur="this.style.borderColor='#e5e7eb'">
                    </div>
                </div>
            </div>

            <!-- User Statistics Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-chart-bar" style="margin-right: 8px; color: #6b7280;"></i>
                    User Statistics
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="font-size: 24px; font-weight: 700; color: #059669; margin-bottom: 4px;"><%= user.shipmentCount || 0 %></div>
                        <div style="font-size: 14px; color: #6b7280;">Total Shipments</div>
                    </div>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="font-size: 24px; font-weight: 700; color: #3b82f6; margin-bottom: 4px;">
                            <%= user.status === 'suspended' ? 'Suspended' : 'Active' %>
                        </div>
                        <div style="font-size: 14px; color: #6b7280;">Account Status</div>
                    </div>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="font-size: 24px; font-weight: 700; color: #f59e0b; margin-bottom: 4px;">
                            <%= new Date(user.createdAt).toLocaleDateString() %>
                        </div>
                        <div style="font-size: 14px; color: #6b7280;">Member Since</div>
                    </div>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="font-size: 24px; font-weight: 700; color: #8b5cf6; margin-bottom: 4px;">
                            <%= user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never' %>
                        </div>
                        <div style="font-size: 14px; color: #6b7280;">Last Login</div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 24px; border-top: 2px solid #e5e7eb;">
                <a href="/admin/users" style="padding: 12px 24px; background: #f3f4f6; border: 2px solid #e5e7eb; border-radius: 8px; color: #374151; text-decoration: none; font-weight: 600; transition: all 0.2s ease;" 
                   onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                    <i class="fas fa-arrow-left"></i>
                    Cancel
                </a>
                <button type="submit" id="submitBtn" style="padding: 12px 32px; background: #8b5cf6; border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.2s ease;" 
                        onmouseover="this.style.background='#7c3aed'" onmouseout="this.style.background='#8b5cf6'">
                    <i class="fas fa-save"></i> Update User
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const submitBtn = document.getElementById('submitBtn');
    
    form.addEventListener('submit', function() {
        // Disable the button and show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 8px;"></span> Updating...';
    });
});
</script>

<style>
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
