<!-- Dashboard Profile -->
<div class="dashboard-card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-icon">
            <i class="fas fa-user-cog"></i>
        </div>
        <div>
            <div class="card-title">Profile Settings</div>
            <div class="card-subtitle">Manage your account information and preferences</div>
        </div>
    </div>
</div>

<!-- Profile Information -->
<div style="display: grid; grid-template-columns: 1fr 300px; gap: 24px;">
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-user"></i>
            </div>
            <div>
                <div class="card-title">Personal Information</div>
                <div class="card-subtitle">Update your personal details</div>
            </div>
        </div>
        <form id="profileForm" style="margin-top: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">First Name *</label>
                    <input type="text" id="firstName" value="<%= user && user.name ? user.name.split(' ')[0] : '' %>" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;" required>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Last Name *</label>
                    <input type="text" id="lastName" value="<%= user && user.name ? user.name.split(' ').slice(1).join(' ') : '' %>" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;" required>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Email Address *</label>
                <input type="email" id="email" value="<%= user && user.email ? user.email : '' %>" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;" required>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Phone Number</label>
                <input type="tel" id="phone" value="+1 (555) 123-4567" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Company</label>
                <input type="text" id="company" value="Acme Corporation" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Address</label>
                <textarea id="address" rows="3" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; resize: vertical;">123 Business St, New York, NY 10001</textarea>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Save Changes
            </button>
        </form>
    </div>

    <!-- Profile Summary -->
    <div>
        <div class="dashboard-card" style="margin-bottom: 24px;">
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="width: 80px; height: 80px; min-width: 80px; min-height: 80px; max-width: 80px; max-height: 80px; background: linear-gradient(135deg, #032330, #1a4c5a); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; aspect-ratio: 1 / 1; flex-shrink: 0; overflow: hidden;">
                    <%= user && user.name ? user.name.charAt(0).toUpperCase() : 'U' %>
                </div>
                <h3 style="margin: 0 0 4px 0; color: #032330;"><%= user && user.name ? user.name : 'User' %></h3>
                <p style="margin: 0; color: #6b7280; font-size: 14px;"><%= user && user.email ? user.email : 'user@example.com' %></p>
            </div>
            <div id="profileStats" style="padding: 16px; background: #f9fafb; border-radius: 10px;">
                <!-- Profile stats will be populated by JavaScript -->
            </div>
        </div>

        <!-- Security Settings -->
        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon" style="width: 32px; height: 32px; font-size: 14px;">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div>
                    <div class="card-title" style="font-size: 16px;">Security</div>
                    <div class="card-subtitle">Account security settings</div>
                </div>
            </div>
            <div style="margin-top: 16px;">
                <button class="btn btn-secondary" onclick="changePassword()" style="width: 100%; margin-bottom: 12px;">
                    <i class="fas fa-key"></i>
                    Change Password
                </button>
                <button class="btn btn-secondary" onclick="enableTwoFactor()" style="width: 100%;">
                    <i class="fas fa-mobile-alt"></i>
                    Enable 2FA
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="dashboard-card" style="margin-top: 24px;">
    <div class="card-header">
        <div class="card-icon">
            <i class="fas fa-bolt"></i>
        </div>
        <div>
            <div class="card-title">Quick Actions</div>
            <div class="card-subtitle">Common profile-related tasks</div>
        </div>
    </div>
    <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
        <button class="btn btn-outline-primary" onclick="viewNotifications()" style="padding: 16px; text-align: left;">
            <i class="fas fa-bell" style="margin-bottom: 8px; font-size: 20px;"></i>
            <div style="font-weight: 600;">View Notifications</div>
            <div style="font-size: 12px; opacity: 0.7;">Manage your alerts</div>
        </button>
        <button class="btn btn-outline-primary" onclick="viewInvoices()" style="padding: 16px; text-align: left;">
            <i class="fas fa-file-invoice" style="margin-bottom: 8px; font-size: 20px;"></i>
            <div style="font-weight: 600;">View Invoices</div>
            <div style="font-size: 12px; opacity: 0.7;">Billing & payments</div>
        </button>
        <button class="btn btn-outline-primary" onclick="viewShipments()" style="padding: 16px; text-align: left;">
            <i class="fas fa-box" style="margin-bottom: 8px; font-size: 20px;"></i>
            <div style="font-weight: 600;">My Shipments</div>
            <div style="font-size: 12px; opacity: 0.7;">Track packages</div>
        </button>
    </div>
</div>

<style>
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #032330;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

@media (max-width: 768px) {
    .dashboard-card:first-child {
        grid-column: 1 / -1;
    }
    
    .dashboard-card:first-child + div {
        grid-column: 1 / -1;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadProfileStats();
    
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        updateProfile();
    });
});

function loadProfileStats() {
    // Load user shipments and invoices for stats
    Promise.all([
        fetch('/dashboard/api/shipments').then(r => r.json()),
        fetch('/dashboard/api/invoices').then(r => r.json())
    ]).then(([shipmentsData, invoicesData]) => {
        const shipments = shipmentsData.success ? shipmentsData.shipments : [];
        const invoices = invoicesData.success ? invoicesData.invoices : [];
        
        renderProfileStats(shipments, invoices);
    }).catch(error => {
        console.error('Error loading profile stats:', error);
        showEmptyProfileStats();
    });
}

function renderProfileStats(shipments, invoices) {
    const statsContainer = document.getElementById('profileStats');
    const memberSince = '<%= user && user.createdAt ? new Date(user.createdAt).toLocaleDateString("en-US", {month: "short", year: "numeric"}) : "Dec 2024" %>';
    
    statsContainer.innerHTML = `
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Member Since</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">${memberSince}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Total Shipments</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">${shipments.length}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Total Invoices</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">${invoices.length}</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
            <span style="font-size: 14px; color: #6b7280;">Account Status</span>
            <span style="font-size: 12px; padding: 4px 8px; background: #d1fae5; color: #065f46; border-radius: 12px; font-weight: 600;">Active</span>
        </div>
    `;
}

function showEmptyProfileStats() {
    const statsContainer = document.getElementById('profileStats');
    const memberSince = '<%= user && user.createdAt ? new Date(user.createdAt).toLocaleDateString("en-US", {month: "short", year: "numeric"}) : "Dec 2024" %>';
    
    statsContainer.innerHTML = `
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Member Since</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">${memberSince}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Total Shipments</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">0</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-size: 14px; color: #6b7280;">Total Invoices</span>
            <span style="font-size: 14px; font-weight: 600; color: #374151;">0</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
            <span style="font-size: 14px; color: #6b7280;">Account Status</span>
            <span style="font-size: 12px; padding: 4px 8px; background: #d1fae5; color: #065f46; border-radius: 12px; font-weight: 600;">Active</span>
        </div>
    `;
}

function updateProfile() {
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const company = document.getElementById('company').value;
    const address = document.getElementById('address').value;
    
    if (!firstName || !lastName || !email) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    // Simulate API call
    console.log('Updating profile:', {
        firstName, lastName, email, phone, company, address
    });
    
    showNotification('Profile updated successfully!', 'success');
}

function changePassword() {
    // This would open a password change modal
    showNotification('Password change feature coming soon', 'info');
}

function enableTwoFactor() {
    // This would open 2FA setup modal
    showNotification('Two-factor authentication setup coming soon', 'info');
}

function viewNotifications() {
    window.location.href = '/dashboard/notifications';
}

function viewInvoices() {
    window.location.href = '/dashboard/invoices';
}

function viewShipments() {
    window.location.href = '/dashboard/orders';
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 10000;
        animation: slideIn 0.3s ease;
    `;
    
    const colors = {
        success: '#10b981',
        error: '#ef4444',
        warning: '#f59e0b',
        info: '#3b82f6'
    };
    notification.style.background = colors[type] || colors.info;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
`;
document.head.appendChild(style);
</script>
