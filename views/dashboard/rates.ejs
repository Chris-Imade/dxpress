<!-- Real-time Shipping Rates -->
<div class="dashboard-card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-icon">
            <i class="fas fa-calculator"></i>
        </div>
        <div>
            <div class="card-title">Get Shipping Rates</div>
            <div class="card-subtitle">Compare rates from multiple carriers</div>
        </div>
    </div>
    <form id="ratesForm" style="margin-top: 20px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
            <div style="min-width: 0;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">From</label>
                <input type="text" id="fromAddress" placeholder="Origin address" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; box-sizing: border-box;" required>
            </div>
            <div style="min-width: 0;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">To</label>
                <input type="text" id="toAddress" placeholder="Destination address" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; box-sizing: border-box;" required>
            </div>
            <div style="min-width: 0;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Weight (kg)</label>
                <input type="number" id="weight" placeholder="Package weight" min="0.1" step="0.1" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; box-sizing: border-box;" required>
            </div>
            <div style="min-width: 0;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Dimensions (cm)</label>
                <div style="display: flex; gap: 6px;">
                    <input type="number" id="length" placeholder="L" min="1" style="flex: 1; min-width: 0; padding: 12px 6px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; box-sizing: border-box;" required>
                    <input type="number" id="width" placeholder="W" min="1" style="flex: 1; min-width: 0; padding: 12px 6px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; box-sizing: border-box;" required>
                    <input type="number" id="height" placeholder="H" min="1" style="flex: 1; min-width: 0; padding: 12px 6px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; box-sizing: border-box;" required>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">
            <i class="fas fa-search"></i>
            Get Shipping Rates
        </button>
    </form>
</div>

<!-- Shipping Rates Results -->
<div id="ratesResults" style="display: none;">
    <div class="dashboard-card" style="margin-bottom: 24px;">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-shipping-fast"></i>
            </div>
            <div>
                <div class="card-title">Available Shipping Options</div>
                <div class="card-subtitle">Compare prices and delivery times</div>
            </div>
        </div>
        <div id="ratesContainer" style="margin-top: 20px;">
            <!-- Rates will be populated here -->
        </div>
    </div>
</div>

<!-- Rate History -->
<div class="dashboard-card">
    <div class="card-header">
        <div class="card-icon">
            <i class="fas fa-history"></i>
        </div>
        <div>
            <div class="card-title">Recent Rate Calculations</div>
            <div class="card-subtitle">Your recent shipping rate queries</div>
        </div>
    </div>
    <div style="margin-top: 16px;">
        <div class="rate-history-item" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid #e5e7eb; border-radius: 10px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #032330, #1a4c5a); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-route"></i>
                </div>
                <div>
                    <div style="font-weight: 600; color: #032330;">New York → Los Angeles</div>
                    <div style="font-size: 14px; color: #6b7280;">2.5 kg • 30×20×15 cm</div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 600; color: #032330;">From $45.99</div>
                <div style="font-size: 12px; color: #6b7280;">2 hours ago</div>
            </div>
        </div>

        <div class="rate-history-item" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid #e5e7eb; border-radius: 10px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #032330, #1a4c5a); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-route"></i>
                </div>
                <div>
                    <div style="font-weight: 600; color: #032330;">Chicago → Miami</div>
                    <div style="font-size: 14px; color: #6b7280;">1.8 kg • 25×15×10 cm</div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 600; color: #032330;">From $38.50</div>
                <div style="font-size: 12px; color: #6b7280;">1 day ago</div>
            </div>
        </div>

        <div class="rate-history-item" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid #e5e7eb; border-radius: 10px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #032330, #1a4c5a); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-route"></i>
                </div>
                <div>
                    <div style="font-weight: 600; color: #032330;">Seattle → Boston</div>
                    <div style="font-size: 14px; color: #6b7280;">3.2 kg • 40×30×20 cm</div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 600; color: #032330;">From $52.75</div>
                <div style="font-size: 12px; color: #6b7280;">3 days ago</div>
            </div>
        </div>
    </div>
</div>

<style>
.rate-card {
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.rate-card:hover {
    border-color: #032330;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(3, 35, 48, 0.1);
}

.rate-card.selected {
    border-color: #032330;
    background: #f0f9ff;
}

.carrier-logo {
    width: 60px;
    height: 40px;
    background: #f3f4f6;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #374151;
    font-size: 12px;
}

.rate-price {
    font-size: 24px;
    font-weight: 700;
    color: #032330;
}

.rate-delivery {
    font-size: 14px;
    color: #6b7280;
    margin-top: 4px;
}

.rate-features {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
}

.rate-feature {
    background: #f3f4f6;
    color: #374151;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
}

.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #032330;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('ratesForm').addEventListener('submit', function(e) {
        e.preventDefault();
        calculateRates();
    });
});

function calculateRates() {
    const fromAddress = document.getElementById('fromAddress').value;
    const toAddress = document.getElementById('toAddress').value;
    const weight = document.getElementById('weight').value;
    const length = document.getElementById('length').value;
    const width = document.getElementById('width').value;
    const height = document.getElementById('height').value;

    if (!fromAddress || !toAddress || !weight || !length || !width || !height) {
        alert('Please fill in all fields');
        return;
    }

    // Show loading state
    const resultsDiv = document.getElementById('ratesResults');
    const container = document.getElementById('ratesContainer');
    
    resultsDiv.style.display = 'block';
    container.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading-spinner"></div><p style="margin-top: 16px; color: #6b7280;">Calculating shipping rates...</p></div>';

    // Simulate API call
    setTimeout(() => {
        displayRates(fromAddress, toAddress, weight, length, width, height);
    }, 2000);
}

function displayRates(from, to, weight, length, width, height) {
    const volume = (length * width * height) / 1000; // Convert to liters
    const basePrice = Math.max(weight * 15, volume * 10); // Price based on weight or volume
    
    const carriers = [
        {
            name: 'DHL Express',
            logo: 'DHL',
            price: (basePrice * 1.2).toFixed(2),
            delivery: '1-2 business days',
            features: ['Express Delivery', 'Tracking Included', 'Insurance Available'],
            color: '#d40511'
        },
        {
            name: 'FedEx Priority',
            logo: 'FedEx',
            price: (basePrice * 1.1).toFixed(2),
            delivery: '2-3 business days',
            features: ['Priority Handling', 'Real-time Tracking', 'Signature Required'],
            color: '#4d148c'
        },
        {
            name: 'UPS Ground',
            logo: 'UPS',
            price: (basePrice * 0.9).toFixed(2),
            delivery: '3-5 business days',
            features: ['Ground Delivery', 'Package Tracking', 'Delivery Confirmation'],
            color: '#8b4513'
        },
        {
            name: 'USPS Priority Mail',
            logo: 'USPS',
            price: (basePrice * 0.8).toFixed(2),
            delivery: '2-3 business days',
            features: ['Priority Mail', 'Free Tracking', 'Insurance Included'],
            color: '#004b87'
        }
    ];

    const container = document.getElementById('ratesContainer');
    container.innerHTML = carriers.map(carrier => `
        <div class="rate-card" onclick="selectRate('${carrier.name}', '${carrier.price}')">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div class="carrier-logo" style="background: ${carrier.color}; color: white;">
                        ${carrier.logo}
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #1a1f36; font-size: 16px;">${carrier.name}</div>
                        <div class="rate-delivery">${carrier.delivery}</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div class="rate-price">$${carrier.price}</div>
                    <div style="font-size: 12px; color: #6b7280;">+ taxes & fees</div>
                </div>
            </div>
            <div class="rate-features">
                ${carrier.features.map(feature => `<span class="rate-feature">${feature}</span>`).join('')}
            </div>
            <div style="margin-top: 16px;">
                <button class="btn btn-primary" style="width: 100%; padding: 10px;" onclick="event.stopPropagation(); createShipmentWithRate('${carrier.name}', '${carrier.price}')">
                    <i class="fas fa-plus"></i>
                    Create Shipment
                </button>
            </div>
        </div>
    `).join('');
}

function selectRate(carrierName, price) {
    // Remove previous selections
    document.querySelectorAll('.rate-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selection to clicked card
    event.currentTarget.classList.add('selected');
    
    console.log('Selected rate:', carrierName, price);
}

function createShipmentWithRate(carrierName, price) {
    // Pre-fill shipment creation form with selected rate
    const shipmentUrl = `/dashboard/create-shipment?carrier=${encodeURIComponent(carrierName)}&price=${price}&from=${encodeURIComponent(document.getElementById('fromAddress').value)}&to=${encodeURIComponent(document.getElementById('toAddress').value)}&weight=${document.getElementById('weight').value}`;
    window.location.href = shipmentUrl;
}

// Auto-complete for addresses (you can integrate with Google Places API or similar)
function initializeAddressAutocomplete() {
    const fromInput = document.getElementById('fromAddress');
    const toInput = document.getElementById('toAddress');
    
    // Sample implementation - replace with actual autocomplete service
    const commonCities = [
        'New York, NY',
        'Los Angeles, CA',
        'Chicago, IL',
        'Houston, TX',
        'Phoenix, AZ',
        'Philadelphia, PA',
        'San Antonio, TX',
        'San Diego, CA',
        'Dallas, TX',
        'San Jose, CA'
    ];
    
    [fromInput, toInput].forEach(input => {
        input.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            if (value.length > 2) {
                const matches = commonCities.filter(city => 
                    city.toLowerCase().includes(value)
                );
                // You can implement a dropdown here
                console.log('Address suggestions:', matches);
            }
        });
    });
}

// Initialize autocomplete when page loads
initializeAddressAutocomplete();
</script>
